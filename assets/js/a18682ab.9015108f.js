"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6396],{18937:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"installation-steps-advanced/SetupTLSHTTPSDockerComposeTraefikV2","title":"Setup TLS / HTTPS Docker Compose + Traefik v2","description":"Practical guide to setting up TLS/HTTPS in our test results dashboard","source":"@site/docs/installation-steps-advanced/SetupTLSHTTPSDockerComposeTraefikV2.md","sourceDirName":"installation-steps-advanced","slug":"/installation-steps-advanced/SetupTLSHTTPSDockerComposeTraefikV2","permalink":"/docs/installation-steps-advanced/SetupTLSHTTPSDockerComposeTraefikV2","draft":false,"unlisted":false,"editUrl":"https://github.com/reportportal/docs/blob/develop/docs/installation-steps-advanced/SetupTLSHTTPSDockerComposeTraefikV2.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"sidebar_label":"Setup TLS / HTTPS Docker Compose + Traefik v2","description":"Practical guide to setting up TLS/HTTPS in our test results dashboard"},"sidebar":"docs","previous":{"title":"Additional configuration parameters","permalink":"/docs/installation-steps-advanced/AdditionalConfigurationParameters"},"next":{"title":"Migrate one instance to another","permalink":"/docs/installation-steps-advanced/MigrateOneInstanceToAnother"}}');var t=r(74848),i=r(28453);const l={sidebar_position:10,sidebar_label:"Setup TLS / HTTPS Docker Compose + Traefik v2",description:"Practical guide to setting up TLS/HTTPS in our test results dashboard"},c="Setup TLS / HTTPS Docker Compose + Traefik v2",d={},o=[{value:"1. Supported TLS Scenarios",id:"1-supported-tls-scenarios",level:2},{value:"2. Test Environment (Reference)",id:"2-test-environment-reference",level:2},{value:"3. Scenario 1 \u2014 Self-Signed Certificates (OpenSSL)",id:"3-scenario-1--self-signed-certificates-openssl",level:2},{value:"3.1 Generate Certificates",id:"31-generate-certificates",level:3},{value:"3.2 Traefik File Provider (TLS)",id:"32-traefik-file-provider-tls",level:3},{value:"3.3 Validation \u2014 Self-Signed TLS",id:"33-validation--self-signed-tls",level:3},{value:"4. Scenario 2 \u2014 Let\u2019s Encrypt (HTTP-01)",id:"4-scenario-2--lets-encrypt-http-01",level:2},{value:"4.1 Prerequisites (Mandatory)",id:"41-prerequisites-mandatory",level:3},{value:"4.2 Prepare ACME Storage",id:"42-prepare-acme-storage",level:3},{value:"4.3 Docker Compose \u2014 Traefik Gateway",id:"43-docker-compose--traefik-gateway",level:3},{value:"4.4 Service TLS Labels",id:"44-service-tls-labels",level:3},{value:"5. Validation \u2014 Let\u2019s Encrypt (HTTP-01)",id:"5-validation--lets-encrypt-http-01",level:2},{value:"6. Private Subnets \u2014 Important Limitation",id:"6-private-subnets--important-limitation",level:2},{value:"7. Troubleshooting",id:"7-troubleshooting",level:2},{value:"8. Summary",id:"8-summary",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"setup-tls--https-docker-compose--traefik-v2",children:"Setup TLS / HTTPS Docker Compose + Traefik v2"})}),"\n",(0,t.jsxs)(n.p,{children:["This guide documents how to enable HTTPS for a ReportPortal Docker Compose deployment using ",(0,t.jsx)(n.strong,{children:"Traefik v2"})," as the reverse proxy. It covers both ",(0,t.jsx)(n.strong,{children:"self-signed certificates"})," (for local or internal testing) and ",(0,t.jsx)(n.strong,{children:"Let\u2019s Encrypt certificates"})," (for publicly trusted TLS)."]}),"\n",(0,t.jsx)(n.h2,{id:"1-supported-tls-scenarios",children:"1. Supported TLS Scenarios"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Certificate Type"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Environment"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Public Internet Required"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Self-signed (OpenSSL)"}),(0,t.jsx)(n.td,{children:"Localhost / Internal VPC"}),(0,t.jsx)(n.td,{children:"No"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Let\u2019s Encrypt (HTTP-01)"}),(0,t.jsx)(n.td,{children:"Public EC2 + Route 53"}),(0,t.jsx)(n.td,{children:"Yes"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Let\u2019s Encrypt (DNS-01)"}),(0,t.jsx)(n.td,{children:"Private VPC"}),(0,t.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,t.jsx)(n.admonition,{type:"important",children:(0,t.jsxs)(n.p,{children:["Let\u2019s Encrypt HTTP-01 validation requires ",(0,t.jsx)(n.strong,{children:"public internet reachability"}),".",(0,t.jsx)("br",{}),"\nDeployments in private subnets without an Internet Gateway ",(0,t.jsx)(n.strong,{children:"must use DNS-01"})," instead."]})}),"\n",(0,t.jsx)(n.h2,{id:"2-test-environment-reference",children:"2. Test Environment (Reference)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"AWS Infrastructure (HTTP-01 scenario)"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Component"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Specification"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"EC2"}),(0,t.jsx)(n.td,{children:"t3.medium (2 vCPU, 4 GB RAM) /"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"OS"}),(0,t.jsx)(n.td,{children:"Ubuntu 24.04 / Amazon Linux 2023"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Subnet"}),(0,t.jsx)(n.td,{children:"Public subnet with IGW"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"DNS"}),(0,t.jsx)(n.td,{children:"Route 53 public hosted zone"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Domain"}),(0,t.jsx)(n.td,{children:(0,t.jsx)("a",{children:"tls-docker.example.com"})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Using a public subnet removes ambiguity during troubleshooting."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Required Security Group Rules"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Type"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Port"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Source"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Purpose"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HTTP"}),(0,t.jsx)(n.td,{children:"80"}),(0,t.jsx)(n.td,{children:"0.0.0.0/0"}),(0,t.jsx)(n.td,{children:"ACME HTTP-01"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"HTTPS"}),(0,t.jsx)(n.td,{children:"443"}),(0,t.jsx)(n.td,{children:"0.0.0.0/0"}),(0,t.jsx)(n.td,{children:"HTTPS access"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TCP"}),(0,t.jsx)(n.td,{children:"8081"}),(0,t.jsx)(n.td,{children:"Your IP"}),(0,t.jsx)(n.td,{children:"Traefik dashboard"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SSH"}),(0,t.jsx)(n.td,{children:"22"}),(0,t.jsx)(n.td,{children:"Your IP"}),(0,t.jsx)(n.td,{children:"Management"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"3-scenario-1--self-signed-certificates-openssl",children:"3. Scenario 1 \u2014 Self-Signed Certificates (OpenSSL)"}),"\n",(0,t.jsx)(n.h3,{id:"31-generate-certificates",children:"3.1 Generate Certificates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'mkdir -p certs\n\nopenssl genrsa -out certs/reportportal.key 2048\n\nopenssl req -new -x509 \\\n  -key certs/reportportal.key \\\n  -out certs/reportportal.crt \\\n  -days 365 \\\n  -subj "/CN=localhost" \\\n  -addext "subjectAltName=DNS:localhost,IP:127.0.0.1"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"32-traefik-file-provider-tls",children:"3.2 Traefik File Provider (TLS)"}),"\n",(0,t.jsxs)(n.p,{children:["Create ",(0,t.jsx)(n.code,{children:"certs/tls.yml"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"tls:\ncertificates:\n- certFile: /certs/reportportal.crt\nkeyFile: /certs/reportportal.key\n"})}),"\n",(0,t.jsx)(n.h3,{id:"33-validation--self-signed-tls",children:"3.3 Validation \u2014 Self-Signed TLS"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Verify key matches certificate"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"openssl x509 -noout -modulus -in certs/reportportal.crt | openssl md5\nopenssl rsa  -noout -modulus -in certs/reportportal.key | openssl md5\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Trust validation"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl -v --cacert certs/reportportal.crt https://localhost\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Fingerprint comparison"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"oopenssl x509 -in certs/reportportal.crt -noout -fingerprint -sha256\n\nopenssl s_client -connect localhost:443 </dev/null 2>/dev/null \\\n| openssl x509 -noout -fingerprint -sha256\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Subject and validity"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"openssl s_client -connect localhost:443 </dev/null 2>/dev/null \\\n| openssl x509 -noout -subject -issuer -dates\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-scenario-2--lets-encrypt-http-01",children:"4. Scenario 2 \u2014 Let\u2019s Encrypt (HTTP-01)"}),"\n",(0,t.jsx)(n.h3,{id:"41-prerequisites-mandatory",children:"4.1 Prerequisites (Mandatory)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Domain resolves to a ",(0,t.jsx)(n.strong,{children:"public IP"})]}),"\n",(0,t.jsx)(n.li,{children:"EC2 subnet has route:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"0.0.0.0/0 \u2192 Internet Gateway\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ports ",(0,t.jsx)(n.strong,{children:"80"})," and ",(0,t.jsx)(n.strong,{children:"443"})," reachable from the internet"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"42-prepare-acme-storage",children:"4.2 Prepare ACME Storage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"touch acme.json\nchmod 600 acme.json\n"})}),"\n",(0,t.jsx)(n.h3,{id:"43-docker-compose--traefik-gateway",children:"4.3 Docker Compose \u2014 Traefik Gateway"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'services:\ngateway:\nimage: traefik:v2.11.32\nrestart: unless-stopped\nports:\n- "80:80"\n- "443:443"\n- "8081:8081"\nvolumes:\n- /var/run/docker.sock:/var/run/docker.sock:ro\n- ./acme.json:/acme.json\ncommand:\n- --providers.docker=true\n- --providers.docker.exposedbydefault=false\n\n      - --entrypoints.web.address=:80\n      - --entrypoints.websecure.address=:443\n      - --entrypoints.traefik.address=:8081\n \n      - --entrypoints.web.http.redirections.entrypoint.to=websecure\n      - --entrypoints.web.http.redirections.entrypoint.scheme=https\n \n      - --certificatesresolvers.letsencrypt.acme.email=admin@example.com\n      - --certificatesresolvers.letsencrypt.acme.storage=/acme.json\n      - --certificatesresolvers.letsencrypt.acme.httpchallenge=true\n      - --certificatesresolvers.letsencrypt.acme.httpchallenge.entrypoint=web\n \n      - --api.dashboard=true\n      - --api.insecure=true\n'})}),"\n",(0,t.jsx)(n.h3,{id:"44-service-tls-labels",children:"4.4 Service TLS Labels"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'labels:\n- "traefik.enable=true"\n- "traefik.http.routers.app.rule=Host(`tls-docker.example.com`)"\n- "traefik.http.routers.app.entrypoints=websecure"\n- "traefik.http.routers.app.tls=true"\n- "traefik.http.routers.app.tls.certresolver=letsencrypt"\n- "traefik.http.services.app.loadbalancer.server.port=8080"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"5-validation--lets-encrypt-http-01",children:"5. Validation \u2014 Let\u2019s Encrypt (HTTP-01)"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"DNS resolution"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"dig +short tls-docker.example.com\ndig @8.8.8.8 +short tls-docker.example.com\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"TCP reachability"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"nc -vz tls-docker.example.com 80\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"HTTP reachability"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl -v http://tls-docker.example.com\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"ACME challenge path"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"404 Not Found is expected and correct\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"HTTPS validation"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"curl -v https://tls-docker.example.com\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Certificate issuer verification"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"echo | openssl s_client \\\n-connect tls-docker.example.com:443 \\\n-servername tls-docker.example.com \\\n2>/dev/null | openssl x509 -noout -issuer -subject -dates\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected issuer:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"CN = Let's Encrypt\n"})}),"\n",(0,t.jsx)(n.h2,{id:"6-private-subnets--important-limitation",children:"6. Private Subnets \u2014 Important Limitation"}),"\n",(0,t.jsxs)(n.p,{children:["If the domain resolves to a ",(0,t.jsx)(n.strong,{children:"private IP (RFC1918)"})," or the subnet routes traffic via ",(0,t.jsx)(n.strong,{children:"NAT Gateway only"}),", Let\u2019s Encrypt ",(0,t.jsx)(n.strong,{children:"HTTP-01 will fail"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Symptoms"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"DNS resolves internally but not publicly"}),"\n",(0,t.jsx)(n.li,{children:"ACME challenge never triggered"}),"\n",(0,t.jsx)(n.li,{children:"Traefik serves default certificate"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),(0,t.jsx)("br",{}),"\nUse ",(0,t.jsx)(n.strong,{children:"DNS-01 validation"})," with Route 53."]}),"\n",(0,t.jsx)(n.h2,{id:"7-troubleshooting",children:"7. Troubleshooting"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Issue"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Cause"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Resolution"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"ACME never triggers"}),(0,t.jsx)(n.td,{children:"No public ingress"}),(0,t.jsx)(n.td,{children:"Use DNS-01"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Default Traefik cert"}),(0,t.jsx)(n.td,{children:"No issued cert"}),(0,t.jsx)(n.td,{children:"Check ACME logs"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:[(0,t.jsx)("a",{children:"example.com"})," email error"]}),(0,t.jsx)(n.td,{children:"Invalid ACME email"}),(0,t.jsx)(n.td,{children:"Use real domain"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Permission denied acme.json"}),(0,t.jsx)(n.td,{children:"Wrong file mode"}),(0,t.jsx)(n.td,{children:"chmod 600"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"404 from HTTPS"}),(0,t.jsx)(n.td,{children:"Host rule mismatch"}),(0,t.jsx)(n.td,{children:"Verify router rule"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"8-summary",children:"8. Summary"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Self-signed TLS works for ",(0,t.jsx)(n.strong,{children:"local and internal environments"})]}),"\n",(0,t.jsxs)(n.li,{children:["Let\u2019s Encrypt HTTP-01 works ",(0,t.jsx)(n.strong,{children:"only with public ingress"})]}),"\n",(0,t.jsxs)(n.li,{children:["DNS-01 is required for ",(0,t.jsx)(n.strong,{children:"private VPC deployments"})]}),"\n",(0,t.jsx)(n.li,{children:"Traefik configuration remains identical; only the ACME method changes"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>c});var s=r(96540);const t={},i=s.createContext(t);function l(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);