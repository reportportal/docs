"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[22711],{37963:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"quality-gates/IntegrationWithCICD/IntegrationWithAzureDevOps","title":"Integration with Azure DevOps","description":"This tutorial guides you through the process of integrating ReportPortal with Azure DevOps for Node.js projects. Depending on your project, you can use either a Bash (Linux) or Powershell script. This pipeline includes steps for the application build, running tests, capturing the ReportPortal Launch ID, and implementing a Quality Gate check.","source":"@site/docs/quality-gates/IntegrationWithCICD/IntegrationWithAzureDevOps.md","sourceDirName":"quality-gates/IntegrationWithCICD","slug":"/quality-gates/IntegrationWithCICD/IntegrationWithAzureDevOps","permalink":"/docs/quality-gates/IntegrationWithCICD/IntegrationWithAzureDevOps","draft":false,"unlisted":false,"editUrl":"https://github.com/reportportal/docs/blob/develop/docs/quality-gates/IntegrationWithCICD/IntegrationWithAzureDevOps.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"Integration with Azure DevOps"},"sidebar":"docs","previous":{"title":"Integration with CI/CD","permalink":"/docs/quality-gates/IntegrationWithCICD/"},"next":{"title":"Integration with Bitrise CI/CD","permalink":"/docs/quality-gates/IntegrationWithCICD/IntegrationWithBitrise"}}');var s=t(74848),r=t(28453);const a={sidebar_label:"Integration with Azure DevOps"},l="Integration with Azure DevOps",o={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Azure DevOps Pipeline Overview",id:"azure-devops-pipeline-overview",level:2},{value:"Configuring Azure DevOps pipeline",id:"configuring-azure-devops-pipeline",level:2},{value:"Azure Pipeline Configuration File",id:"azure-pipeline-configuration-file",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Step 1: Run application build and tests",id:"step-1-run-application-build-and-tests",level:3},{value:"Bash Script",id:"bash-script",level:4},{value:"Powershell Script",id:"powershell-script",level:4},{value:"Step 2: Quality Gate",id:"step-2-quality-gate",level:3},{value:"Bash Script",id:"bash-script-1",level:4},{value:"Powershell Script",id:"powershell-script-1",level:4},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"integration-with-azure-devops",children:"Integration with Azure DevOps"})}),"\n",(0,s.jsx)(n.p,{children:"This tutorial guides you through the process of integrating ReportPortal with Azure DevOps for Node.js projects. Depending on your project, you can use either a Bash (Linux) or Powershell script. This pipeline includes steps for the application build, running tests, capturing the ReportPortal Launch ID, and implementing a Quality Gate check."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Before you begin, ensure you have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"An Azure DevOps account set up."}),"\n",(0,s.jsx)(n.li,{children:"ReportPortal account and a project created."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"azure-devops-pipeline-overview",children:"Azure DevOps Pipeline Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Azure DevOps pipeline for integrating ReportPortal consists of the following key steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Run application build and tests:"})," Execute npm tests."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Capture Launch ID:"})," Extract the ReportPortal Launch ID from the test execution logs."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quality Gate:"})," Check the Quality Gate status on ReportPortal using the captured Launch ID."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-azure-devops-pipeline",children:"Configuring Azure DevOps pipeline"}),"\n",(0,s.jsx)(n.h3,{id:"azure-pipeline-configuration-file",children:"Azure Pipeline Configuration File"}),"\n",(0,s.jsxs)(n.p,{children:["To configure Azure pipeline, you need a YAML file that defines your build steps. You can name this file as you want, such as ",(0,s.jsx)(n.code,{children:"azure-pipelines.yml"})," or ",(0,s.jsx)(n.code,{children:"ci.yml"}),". This file should be located at the root of your repository or in a ",(0,s.jsx)(n.code,{children:".azure-pipelines"})," directory."]}),"\n",(0,s.jsx)(n.p,{children:"To get Azure DevOps to recognize and run your pipeline, you need to point it towards your YAML file:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["In your Azure DevOps project, go to ",(0,s.jsx)(n.strong,{children:"Pipelines > Pipelines"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Select ",(0,s.jsx)(n.strong,{children:"New Pipeline"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Choose your repository and branch where your YAML file is located."}),"\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Configure"})," tab, choose ",(0,s.jsx)(n.strong,{children:"YAML"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Select your YAML file and click ",(0,s.jsx)(n.strong,{children:"Save and Run"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Since the YAML file contains your CI configuration, it is essential to understand its syntax for successful setup. More on YAML syntax and pipelines configuration can be found in the ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/devops/pipelines/get-started/pipelines-get-started?view=azure-devops#define-your-build-pipeline",children:"Azure Pipelines documentation"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.p,{children:"Set the following environment variables in your Azure DevOps Pipeline:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RP_INSTANCE_URL"}),": The URL of your ReportPortal instance."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RP_PROJECT"}),": The ReportPortal project name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"REQUEST_TIMEOUT_SECONDS"}),": Timeout for ReportPortal API requests."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SCRIPT_TIMEOUT_SECONDS"}),": Timeout for the entire script execution."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["In the ",(0,s.jsx)(n.strong,{children:"Variables"})," section, add the following sensitive variable:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RP_API_KEY"}),": Your API key from ReportPortal."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"step-1-run-application-build-and-tests",children:"Step 1: Run application build and tests"}),"\n",(0,s.jsxs)(n.p,{children:["Use the following scripts to run tests with npm. The test execution logs are captured in ",(0,s.jsx)(n.code,{children:"./console.log"}),". Then the ReportPortal Launch ID is extracted and saved in ",(0,s.jsx)(n.code,{children:"RP_LAUNCH_ID"}),". The script you choose depends on whether you are using Bash or Powershell."]}),"\n",(0,s.jsx)(n.h4,{id:"bash-script",children:"Bash Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- script: |\n    set -e\n    npm install\n    npm run test | tee ./console.log || {\n        echo \"Error in tests\" \n        exit 1 \n    }\n    LAUNCH_ID=$(sed -nE 's/.*ReportPortal Launch Link: .*\\/([0-9]+).*/\\1/p' console.log)\n    echo $LAUNCH_ID\n    echo \"##vso[task.setvariable variable=RP_LAUNCH_ID;]$LAUNCH_ID\"\n  displayName: 'Run build'\n  env:\n    RP_API_KEY: $(RP_API_KEY)\n"})}),"\n",(0,s.jsx)(n.h4,{id:"powershell-script",children:"Powershell Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"- powershell: |\n    try {\n      # Run npm install\n      npm install\n        \n      # Run npm run test and save the output to console.log\n      npm run test | Tee-Object -FilePath ./console.log\n    }\n    catch {\n      Write-Host \"Error in tests\"\n    }\n    finally{\n      # Use Select-String to extract the Launch ID from console.log using a regex\n      $LAUNCH_ID = (Get-Content -Path ./console.log | Select-String -Pattern '.*ReportPortal Launch Link: .*\\/([0-9]+).*' | ForEach-Object { $_.Matches.Groups[1].Value })\n        \n      # Print the Launch ID\n      Write-Output $LAUNCH_ID\n        \n      # Set the variable RP_LAUNCH_ID for Azure DevOps\n      Write-Output \"##vso[task.setvariable variable=RP_LAUNCH_ID;]$LAUNCH_ID\"\n      exit 0\n    }\n    \n  displayName: 'Run build'\n  env:\n    RP_API_KEY: $(RP_API_KEY)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-quality-gate",children:"Step 2: Quality Gate"}),"\n",(0,s.jsxs)(n.p,{children:["Use this lifecycle script to wait for the Quality Gate status on ReportPortal using the captured ",(0,s.jsx)(n.code,{children:"RP_LAUNCH_ID"}),'. If the status is not "PASSED", the pipeline fails, meaning the quality gate didn\'t pass and vice versa. Choose either the Bash or Powershell script depending on your project needs.']}),"\n",(0,s.jsx)(n.h4,{id:"bash-script-1",children:"Bash Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- script: |\n    QUALITY_GATE_STATUS=""\n    START_TIME=$(date +%s)\n    # Loop until quality gate status is obtained or timeout is reached\n    while [[ -z "$QUALITY_GATE_STATUS" && $(( $(date +%s) - START_TIME )) -lt $(SCRIPT_TIMEOUT_SECONDS) ]]; do\n      printf "Launch ID $(RP_LAUNCH_ID). Waiting for quality gate status....\\n"\n      sleep 10\n      \n      # Retrieve quality gate status using curl and jq\n      QUALITY_GATE_STATUS=$(curl -s --retry 3 --max-time "$(REQUEST_TIMEOUT_SECONDS)" -H "Authorization: Bearer $(RP_API_KEY)" "$(RP_INSTANCE_URL)/api/v1/$(RP_PROJECT)/launch/$RP_LAUNCH_ID" | jq -r \'.metadata.qualityGate.status // empty\')\n    done\n\n    # Check quality gate status and take appropriate action\n    if [[ "$QUALITY_GATE_STATUS" != "PASSED" ]]; then\n      printf "Quality gate status: %s\\nFailing the pipeline.\\n" "$QUALITY_GATE_STATUS"\n      exit 1\n    else\n      printf "Quality gate status: %s\\nPipeline passed.\\n" "$QUALITY_GATE_STATUS"\n    fi\n\n  displayName: \'Quality gates\'\n  env:\n    RP_API_KEY: $(RP_API_KEY)\n'})}),"\n",(0,s.jsx)(n.h4,{id:"powershell-script-1",children:"Powershell Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'- powershell: |\n    $QUALITY_GATE_STATUS = ""\n    $END_TIME = (Get-Date).AddSeconds($env:SCRIPT_TIMEOUT_SECONDS)\n     \n    # Loop until quality gate status is obtained or timeout is reached\n    while (-not $QUALITY_GATE_STATUS -and (Get-Date) -lt $END_TIME ) {\n        Write-Host "Launch ID $env:RP_LAUNCH_ID. Waiting for quality gate status...."\n        Start-Sleep -Seconds 10\n      \n        # Retrieve quality gate status using Invoke-RestMethod and ConvertFrom-Json\n        $response = Invoke-RestMethod -Uri "$env:RP_INSTANCE_URL/api/v1/$env:RP_PROJECT/launch/$env:RP_LAUNCH_ID" `\n                                         -Headers @{ Authorization = "Bearer $env:RP_API_KEY" } `\n                                         -Method Get -TimeoutSec $env:REQUEST_TIMEOUT_SECONDS\n        $QUALITY_GATE_STATUS = $response.metadata.qualityGate.status\n    }\n      \n    # Check quality gate status and take appropriate action\n    if ($QUALITY_GATE_STATUS -ne "PASSED") {\n        Write-Host "Quality gate status: $QUALITY_GATE_STATUS"\n        Write-Host "Failing the pipeline."\n        exit 1\n    } else {\n        Write-Host "Quality gate status: $QUALITY_GATE_STATUS"\n        Write-Host "Pipeline passed."\n    }\n  displayName: \'Quality gates\'\n  env:\n    RP_API_KEY: $(RP_API_KEY)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"By following this guide, you've integrated ReportPortal with Azure DevOps for Node.js projects using either Bash or Powershell. The Azure DevOps pipeline ensures that npm tests are run, the ReportPortal Launch ID is captured, and a Quality Gate check is performed."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);