"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[17911],{56609:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var t=r(85893),n=r(11151);const o={sidebar_position:7,sidebar_label:"ReportPortal Backup & Restore Guide"},a="ReportPortal Backup & Restore Guide",i={id:"reportportal-configuration/ReportPortalBackupRestoreGuide",title:"ReportPortal Backup & Restore Guide",description:"Introduction",source:"@site/docs/reportportal-configuration/ReportPortalBackupRestoreGuide.md",sourceDirName:"reportportal-configuration",slug:"/reportportal-configuration/ReportPortalBackupRestoreGuide",permalink:"/docs/reportportal-configuration/ReportPortalBackupRestoreGuide",draft:!1,unlisted:!1,editUrl:"https://github.com/reportportal/docs/blob/develop/docs/reportportal-configuration/ReportPortalBackupRestoreGuide.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7,sidebar_label:"ReportPortal Backup & Restore Guide"},sidebar:"docs",previous:{title:"How to get an access token in ReportPortal",permalink:"/docs/reportportal-configuration/HowToGetAnAccessTokenInReportPortal"},next:{title:"Authorization",permalink:"/docs/reportportal-configuration/authorization/"}},c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Docker-based Backup and Restore Processes",id:"docker-based-backup-and-restore-processes",level:2},{value:"PostgreSQL Backup Process",id:"postgresql-backup-process",level:3},{value:"PostgreSQL Backup Process",id:"postgresql-backup-process-1",level:3},{value:"Binary Storage Backup Process",id:"binary-storage-backup-process",level:3},{value:"Binary Storage Restore Process",id:"binary-storage-restore-process",level:3},{value:"Kubernetes-based Backup and Restore Processes",id:"kubernetes-based-backup-and-restore-processes",level:2},{value:"Backup Processes",id:"backup-processes",level:3},{value:"Restore Process",id:"restore-process",level:3},{value:"Cloud-based Backup and Restore Processes",id:"cloud-based-backup-and-restore-processes",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"reportportal-backup--restore-guide",children:"ReportPortal Backup & Restore Guide"}),"\n",(0,t.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(s.p,{children:["In this article, we delve into the essential elements of ReportPortal that require meticulous backup procedures. ",(0,t.jsx)(s.strong,{children:"The two critical components under scrutiny are the database, which relies on PostgreSQL, and the binary storage, represented as Docker volume or Persistent Volume Claims (PVC) for Kubernetes"}),". Understanding the significance of safeguarding these components is paramount for maintaining the integrity and reliability of your ReportPortal."]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsx)(s.p,{children:"It is important to understand that there are various options available for both backing up and restoring ReportPortal database and binary storage. This article provides an illustrative example of one such option."})}),"\n",(0,t.jsx)(s.h2,{id:"docker-based-backup-and-restore-processes",children:"Docker-based Backup and Restore Processes"}),"\n",(0,t.jsx)(s.h3,{id:"postgresql-backup-process",children:"PostgreSQL Backup Process"}),"\n",(0,t.jsxs)(s.p,{children:["Create a backup of the PostgreSQL database using the ",(0,t.jsx)(s.code,{children:"pg_dump"})," command:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"DB_USER=rpuser\nDB_NAME=reportportal\nDB_CONTAINER=postgres\n\n\ndocker exec -t $DB_CONTAINER pg_dump -U $DB_USER -d $DB_NAME > reportportal_docker_db_backup.sql\n"})}),"\n",(0,t.jsx)(s.p,{children:"Explanation:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"docker exec -t $DB_CONTAINER"}),": Executes a command inside the specified Docker container (Pod)."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"pg_dump -U $DB_USER -d $DB_NAME"}),": Initiates the PostgreSQL dump, specifying the username and database name."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"> reportportal_db_backup.sql"}),": Redirects the dump output to a file named ",(0,t.jsx)(s.code,{children:"backup.sql"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Make sure to replace placeholders like ",(0,t.jsx)(s.code,{children:"DB_CONTAINER"}),", ",(0,t.jsx)(s.code,{children:"DB_USER"}),", and ",(0,t.jsx)(s.code,{children:"DB_NAME"})," with your actual container pod name, PostgreSQL username, and database name."]}),"\n",(0,t.jsx)(s.h3,{id:"postgresql-backup-process-1",children:"PostgreSQL Backup Process"}),"\n",(0,t.jsx)(s.p,{children:"To restore PostgreSQL database using following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"DB_USER=rpuser\nDB_NAME=reportportal\nDB_CONTAINER=postgres\n\n\ndocker exec -i $DB_CONTAINER psql -U $DB_USER -d $DB_NAME < reportportal_docker_db_backup.sql\n"})}),"\n",(0,t.jsx)(s.h3,{id:"binary-storage-backup-process",children:"Binary Storage Backup Process"}),"\n",(0,t.jsx)(s.p,{children:"The simple way to backup binary storage is back up the volume\u2019s directory (by default path is /var/lib/docker/volumes/volume_hash)."}),"\n",(0,t.jsx)(s.admonition,{type:"important",children:(0,t.jsx)(s.p,{children:"The following method available from ReportPortal version 24.1."})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'VOLUME_NAME=reportportal_storage\n\ndocker run --rm -v "$VOLUME_NAME":/data -v "$(pwd)":/backup busybox tar -zcvf /backup/reportportal_storage_backup.tar.gz /data\n'})}),"\n",(0,t.jsx)(s.p,{children:"Explanation:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"docker run"}),": This command runs a Docker container."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"--rm"}),": This flag removes the container once it has completed its execution. This is useful for temporary containers, such as when performing a one-off task like creating a backup."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:'-v "$VOLUME_NAME":/storage_backup'}),": This option creates a volume mount between the host machine and the container. It mounts the Docker volume named by the ",(0,t.jsx)(s.code,{children:"reportportal_storage"})," variable to the path ",(0,t.jsx)(s.code,{children:"/storage_backup"})," inside the container."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:'-v "$(pwd)":/backup'}),": This option mounts the current working directory (",(0,t.jsx)(s.code,{children:"$(pwd)"}),") on the host machine to the path ",(0,t.jsx)(s.code,{children:"/backup"})," inside the container. This is where the backup file will be stored."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"busybox"}),": This specifies the Docker image to be used for the container. In this case, it uses the BusyBox image, which is a lightweight and minimalistic Linux distribution often used for simple tasks."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"tar -zcvf /backup/reportportal_storage_backup.tar.gz /storage_backup"}),": This part of the command runs the ",(0,t.jsx)(s.code,{children:"tar"})," command inside the container to create a compressed tar archive (",(0,t.jsx)(s.code,{children:"reportportal_storage_backup.tar.gz"}),")."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"binary-storage-restore-process",children:"Binary Storage Restore Process"}),"\n",(0,t.jsx)(s.p,{children:"Restore the backup using the following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"VOLUME_NAME=reportportal_storage\n\ndocker run --rm -v $VOLUME_NAME:/data -v $(pwd):/backup busybox tar -xzvf /backup/reportportal_storage_backup.tar.gz -C /\n"})}),"\n",(0,t.jsx)(s.h2,{id:"kubernetes-based-backup-and-restore-processes",children:"Kubernetes-based Backup and Restore Processes"}),"\n",(0,t.jsx)(s.h3,{id:"backup-processes",children:"Backup Processes"}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsx)(s.p,{children:"Kubernetes Private Volume Claim backups is made easier with your managed system (e.g. VMWare or Cloud-based tools). You can create snapshots from volumes and attach them to the new environment. This approach is more simpler than the commands described below."})}),"\n",(0,t.jsxs)(s.p,{children:["If you don't have any high-level managed systems for your Kubernetes cluster, you can use ",(0,t.jsx)(s.code,{children:"VolumeSnapshot"}),". This API resource is designed to create volume snapshots for both users and administrators within the Kubernetes cluster."]}),"\n",(0,t.jsxs)(s.p,{children:["This article uses the official Kubernetes documentation ",(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/storage/volume-snapshots/",children:"Volume Snapshots"})," and ",(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/#volume-snapshot-and-restore-volume-from-snapshot-suppot",children:"Restore Volume from Snapshot Support"})]}),"\n",(0,t.jsxs)(s.admonition,{type:"info",children:[(0,t.jsxs)(s.p,{children:["The following example tested on ",(0,t.jsx)(s.strong,{children:"Kubernetes version 1.28"})]}),(0,t.jsxs)(s.p,{children:["Choosing the correct version of CSI is crucial. Make sure to consult the documentation to ensure you select the appropriate version:  ",(0,t.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/storage/volume-snapshots/",children:"Volume Snapshots"}),", ",(0,t.jsx)(s.a,{href:"https://kubernetes-csi.github.io/docs/drivers.html",children:"CSI Driver"}),", ",(0,t.jsx)(s.a,{href:"https://kubernetes-csi.github.io/docs/introduction.html",children:"CSI Introduction"}),", ",(0,t.jsx)(s.a,{href:"https://github.com/kubernetes-csi/csi-driver-host-path#deployment",children:"CSI Driver Host Path (On-Premise)"})]})]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Install the CRD first. Be sure to pay attention to the version ",(0,t.jsx)(s.code,{children:"snapshotter/v6.3.3/client"})," and adjust it based on your Kubernetes version:"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/v6.3.3/client/config/crd/snapshot.storage.k8s.io_volumesnapshotclasses.yaml\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/v6.3.3/client/config/crd/snapshot.storage.k8s.io_volumesnapshotcontents.yaml\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/v6.3.3/client/config/crd/snapshot.storage.k8s.io_volumesnapshots.yaml\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"2",children:["\n",(0,t.jsxs)(s.li,{children:["Install the Snapshot Controller ",(0,t.jsx)(s.code,{children:"v6.3.3"})," for Kubernetes ",(0,t.jsx)(s.code,{children:"1.28"})]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/v6.3.3/deploy/kubernetes/snapshot-controller/setup-snapshot-controller.yaml\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/kubernetes-csi/external-snapshotter/v6.3.3/deploy/kubernetes/snapshot-controller/rbac-snapshot-controller.yaml\n"})}),"\n",(0,t.jsxs)(s.ol,{start:"3",children:["\n",(0,t.jsx)(s.li,{children:"Create VolumeSnapshotClass resource:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'kubectl apply -f - <<EOF\nkind: VolumeSnapshotClass\napiVersion: snapshot.storage.k8s.io/v1\nmetadata:\n  name: volume-snapshot-class\n  annotations:\n    snapshot.storage.kubernetes.io/is-default-class: "true"\ndriver: kubernetes.io/aws-ebs\ndeletionPolicy: Delete\nparameters:\n  type: snap\nEOF\n'})}),"\n",(0,t.jsx)(s.p,{children:"Explanation:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"kind: VolumeSnapshotClass"}),": Specifies the type of Kubernetes resource being defined, which is a VolumeSnapshotClass."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"driver: kubernetes.io/aws-ebs"}),": Specifies the storage driver associated with this VolumeSnapshotClass. In this case, it indicates that the class is intended for use with AWS Elastic Block Store (EBS) volumes. ",(0,t.jsx)(s.strong,{children:"Different cloud and providers or storage systems may have different snapshot drivers."})]}),"\n"]}),"\n",(0,t.jsxs)(s.ol,{start:"4",children:["\n",(0,t.jsx)(s.li,{children:"Create a snapshot:"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f - <<EOF\napiVersion: snapshot.storage.k8s.io/v1  \nkind: VolumeSnapshot  \nmetadata:  \n  name: rp-database-snap  \n  namespace: default   \nspec:  \n  volumeSnapshotClassName: volume-snapshot-class\n  source:  \n    persistentVolumeClaimName: data-my-release-postgresql-0\nEOF\n"})}),"\n",(0,t.jsx)(s.p,{children:"Explanation:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"volumeSnapshotClassName: volume-snapshot-class"}),": Specifies the name of the Kubernetes resource VolumeSnapshotClass that was created in the previous step."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"persistentVolumeClaimName: data-my-release-postgresql-0 "}),": Specifies the name of the target Persistent Volume Claim."]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"restore-process",children:"Restore Process"}),"\n",(0,t.jsxs)(s.p,{children:["You are now prepared to restore the ",(0,t.jsx)(s.code,{children:"VolumeSnapshot"})," to a new Persistent Volume Claim. To proceed, apply the following resource:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kubectl apply -f - <<EOF\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: restored-my-release-postgresql-0\n  namespace: default\nspec:\n  storageClassName: gp2\n  dataSource:\n    name: rp-database-snap\n    kind: VolumeSnapshot\n    apiGroup: snapshot.storage.k8s.io\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 8Gi\nEOF\n"})}),"\n",(0,t.jsx)(s.p,{children:"Explanation:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"storageClassName: gp2"})," : Specifies the class of storage that the claim should use."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"storage: 8Gi"}),": Specifies that the PVC storage capacity. ",(0,t.jsxs)(s.strong,{children:["Must be the same size of ",(0,t.jsx)(s.code,{children:"VolumeSnapshot"})]})]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"cloud-based-backup-and-restore-processes",children:"Cloud-based Backup and Restore Processes"}),"\n",(0,t.jsx)(s.p,{children:"For backups in Cloud-based solutions, we recommend using standard cloud tools."}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["AWS: ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/prescriptive-guidance/latest/backup-recovery/new-ebs-volume-backups.html",children:"EC2 Volume Backup"})," and ",(0,t.jsx)(s.a,{href:"https://docs.aws.amazon.com/prescriptive-guidance/latest/backup-recovery/restore.html",children:"Restore"})]}),"\n",(0,t.jsxs)(s.li,{children:["GCP: ",(0,t.jsx)(s.a,{href:"https://cloud.google.com/architecture/partners/netapp-cloud-volumes/back-up",children:"Back up and restore a cloud volume"})]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,n.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,s,r)=>{r.d(s,{Z:()=>i,a:()=>a});var t=r(67294);const n={},o=t.createContext(n);function a(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);