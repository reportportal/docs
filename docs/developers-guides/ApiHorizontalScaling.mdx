# Scaling the API Service in ReportPortal

ReportPortal supports dynamic scaling of its API service during runtime to efficiently manage varying loads. This guide provides instructions on how to scale the API service up or down, and discusses the implications on asynchronous reporting and queue management in RabbitMQ while scaling.

## Scaling Up the API Service

### Steps to Scale Up
1. **Launch Additional Instances**: Increase the capacity by starting more instances of the API service.
2. **Load Balancing**: The load balancer will automatically distribute incoming requests among all active API service instances.

## Scaling Down the API Service

### Steps to Scale Down
1. **Shutdown Instances**: Decrease the scale by shutting down any of the API service instances.
2. **Message Redistribution**: Messages in the queues of the shutdown instance will automatically shift to the queues of the remaining active APIs.
3. **Queue Cleanup**: Inactive queues (those not receiving any new messages) will be removed after a few minutes.

## Impact on Asynchronous Reporting and Queue Management

### Considerations for Scaling Up
- **Message Rebalancing**: During periods of heavy asynchronous reporting, scaling up may cause messages to be rebalanced across different queues, despite using "Consistent Hashing Algorithm" for distribution. It may lead to an increased number of retries. It might take approx. 2 hours to restore order using retry logic with progressively increasing TTL for each message.
- **Avoid During Heavy Reporting**: Given the potential complexities in message handling when scaling up, it is advisable to refrain from doing so during extensive reporting activities to prevent hard-to-resolve situations and missed reporting items.

### Considerations for Scaling Down
- **Continuity in Message Processing**: Shutting down an API instance leads to its queues redistributing their messages to the remaining queues, ensuring no disruption in processing.

### Notable Effects
Scaling operations primarily affect asynchronous report processing and management within RabbitMQ queues:

- **Order Processing Assurance**: To maintain correct order processing of reports for a specific Launch, all requests are directed to one particular queue and handled by only one consumer.

### About RabbitMQ Queues
- **Scaling Limitations**: Currently, it is not possible to scale queues in RabbitMQ with spreading requests across multiple queues and consumers.

## Conclusion
Effective management of the API service's scaling can help handle different workloads efficiently in ReportPortal. However, careful planning and consideration of asynchronous reporting and queue management are essential to ensure a smooth scaling process. Timing the scaling activities to avoid peak reporting times is also crucial to minimize disruption and complexity.
